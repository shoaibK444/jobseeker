<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Dashboard - Job Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        /* Navigation */
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-decoration: none;
        }

        .navbar-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .navbar-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .navbar-links a:hover {
            background: rgba(255,255,255,0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .user-info span {
            font-weight: 500;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #f0f0f0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Management Profile Header */
        .management-header {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-avatar span {
            font-size: 48px;
            color: white;
            font-weight: bold;
        }

        .profile-info h1 {
            color: #333;
            margin-bottom: 5px;
            font-size: 32px;
        }

        .profile-designation {
            color: #667eea;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .profile-email {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .profile-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-management {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .badge-active {
            background: #d4edda;
            color: #155724;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
        }

        .stat-card .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .stat-label {
            color: #666;
            margin-top: 5px;
        }

        /* Cards */
        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Jobs List */
        .jobs-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .job-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .job-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .job-item p {
            color: #666;
            font-size: 14px;
        }

        .job-meta {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .job-meta span {
            color: #999;
            font-size: 12px;
        }

        .job-status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .job-status.active {
            background: #d4edda;
            color: #155724;
        }

        /* Applications List */
        .applications-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .application-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .application-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .application-item p {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .application-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .application-meta span {
            color: #999;
            font-size: 13px;
        }

        .application-status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .application-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .application-status.interview {
            background: #cce5ff;
            color: #004085;
        }

        .application-status.accepted {
            background: #d4edda;
            color: #155724;
        }

        .application-status.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        /* Profile Detail Sections */
        .profile-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }

        .detail-item label {
            display: block;
            color: #999;
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .detail-item span {
            color: #333;
            font-weight: 500;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            background: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-left: 4px solid #28a745;
        }

        .toast.error {
            border-left: 4px solid #dc3545;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tab-nav {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 100px;
            }

            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .container {
                padding: 15px;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="#" class="navbar-brand" onclick="showPage('home')">Job Portal</a>
        <div class="navbar-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="management-dashboard.html">My Profile</a>
        </div>
        <div class="user-info">
            <span id="userName"></span>
            <button class="btn btn-secondary btn-small" onclick="logout()">Logout</button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('profile')" id="tab-profile">üë§ My Profile</button>
            <button class="tab-btn" onclick="switchTab('jobs')" id="tab-jobs">üíº My Jobs</button>
            <button class="tab-btn" onclick="switchTab('applications')" id="tab-applications">üìã My Applications</button>
        </div>

        <!-- Profile Tab -->
        <div class="tab-content active" id="content-profile">
            <!-- Management Profile Header -->
            <div class="management-header">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">
                        <span id="avatarInitials">MS</span>
                    </div>
                    <div class="profile-info">
                        <h1 id="userFullName">Muhammad Shoaib</h1>
                        <p class="profile-designation" id="userDesignation">Chief Executive Officer</p>
                        <p class="profile-email" id="userEmail">ceo@jobportal.com</p>
                        <div class="profile-badges">
                            <span class="badge badge-management">Management</span>
                            <span class="badge badge-active">Active</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Details -->
            <div class="card" id="profileDetailsCard">
                <h3>üìù Profile Details</h3>
                <div class="profile-detail-grid" id="profileDetails">
                    <div class="detail-item">
                        <label>Role</label>
                        <span id="accountRole">Management</span>
                    </div>
                    <div class="detail-item">
                        <label>Member Since</label>
                        <span id="memberSince">2024</span>
                    </div>
                </div>
                <button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.href='management-profile.html'">
                    ‚úèÔ∏è Edit/Complete Profile
                </button>
            </div>
        </div>

        <!-- Jobs Tab -->
        <div class="tab-content" id="content-jobs">
            <div class="card">
                <h3>üíº My Posted Jobs</h3>
                <div class="jobs-list" id="jobsList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üíº</div>
                        <p>No jobs posted yet</p>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="showToast('Job posting feature coming soon!', 'success')">
                            Post a Job
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applications Tab -->
        <div class="tab-content" id="content-applications">
            <div class="card">
                <h3>üìã Applications Received</h3>
                <div class="applications-list" id="applicationsList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No applications received yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid (always visible) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="statJobs">0</div>
                <div class="stat-label">Active Jobs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statApplications">0</div>
                <div class="stat-label">Applications</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statInterviews">0</div>
                <div class="stat-label">Interviews</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statHired">0</div>
                <div class="stat-label">Hired</div>
            </div>
        </div>
    </div>

    <script>
        // API URL configuration
        const API_URL = window.location.origin;
        let currentUser = null;

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`content-${tabName}`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Load data based on tab
            if (tabName === 'jobs') {
                loadJobs();
            } else if (tabName === 'applications') {
                loadApplications();
            }
        }

        // Check authentication and load user data
        async function checkAuth() {
            const token = localStorage.getItem('authToken');
            const storedUser = localStorage.getItem('currentUser');

            if (!token || !storedUser) {
                window.location.href = 'login.html';
                return null;
            }

            const user = JSON.parse(storedUser);
            
            // Check if user is management role
            if (user.role !== 'management') {
                showToast('Access denied. Management account required.', 'error');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
                return null;
            }

            return user;
        }

        // Display user profile
        async function displayUserProfile(user) {
            try {
                const response = await fetch(`${API_URL}/api/auth/me`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
                });
                if (response.ok) {
                    const fullUser = await response.json();
                    currentUser = fullUser;
                    localStorage.setItem('currentUser', JSON.stringify(fullUser));
                    
                    const initials = fullUser.name ? fullUser.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) : 'M';
                    const designation = fullUser.designation || fullUser.profile?.designation || '';
                    
                    // Avatar - show designation if no photo
                    if (fullUser.profile?.photo) {
                        document.getElementById('profileAvatar').innerHTML = `<img src="${fullUser.profile.photo}" alt="Profile">`;
                    } else if (designation) {
                        // Show designation abbreviation
                        const desigAbbr = designation === 'CEO' ? 'CEO' : 
                                         designation === 'Managing Director' ? 'MD' :
                                         designation === 'Chairman' ? 'CHA' :
                                         designation === 'President' ? 'PRE' :
                                         designation === 'Employee' ? 'EMP' :
                                         designation.substring(0, 3).toUpperCase();
                        document.getElementById('avatarInitials').textContent = desigAbbr;
                    } else {
                        document.getElementById('avatarInitials').textContent = initials;
                    }
                    
                    document.getElementById('userFullName').textContent = fullUser.name || 'Management User';
                    document.getElementById('userDesignation').textContent = fullUser.designation || fullUser.profile?.managementProfile?.positionTitle || 'Management';
                    document.getElementById('userEmail').textContent = fullUser.email;
                    document.getElementById('userName').textContent = fullUser.name || 'Management User';
                    document.getElementById('accountRole').textContent = fullUser.role.charAt(0).toUpperCase() + fullUser.role.slice(1);
                    
                    // Check profile completion
                    const mp = fullUser.profile?.managementProfile;
                    if (!mp || !mp.isManagementProfile) {
                        showToast('Please complete your management profile!', 'error');
                        const badgeContainer = document.querySelector('.profile-badges');
                        const warningBadge = document.createElement('span');
                        warningBadge.className = 'badge';
                        warningBadge.style.background = '#ffc107';
                        warningBadge.style.color = '#000';
                        warningBadge.textContent = 'Profile Incomplete';
                        badgeContainer.appendChild(warningBadge);
                    }
                    
                    // Show management details if available
                    if (mp) {
                        showManagementDetails(mp);
                    }
                    
                    if (fullUser.createdAt) {
                        const year = new Date(fullUser.createdAt).getFullYear();
                        document.getElementById('memberSince').textContent = year;
                    }
                    
                    // Load stats
                    loadStats();
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
                const initials = user.name ? user.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) : 'M';
                document.getElementById('avatarInitials').textContent = initials;
                document.getElementById('userFullName').textContent = user.name || 'Management User';
            }
        }

        // Show management details
        function showManagementDetails(mp) {
            const detailsDiv = document.getElementById('profileDetails');
            detailsDiv.innerHTML = `
                <div class="detail-item">
                    <label>Role</label>
                    <span>${currentUser?.role?.charAt(0).toUpperCase() + currentUser?.role?.slice(1) || 'Management'}</span>
                </div>
                <div class="detail-item">
                    <label>Member Since</label>
                    <span>${currentUser?.createdAt ? new Date(currentUser.createdAt).getFullYear() : 'N/A'}</span>
                </div>
                ${mp.companyName ? `
                <div class="detail-item">
                    <label>Company</label>
                    <span>${mp.companyName}</span>
                </div>
                ` : ''}
                ${mp.positionTitle ? `
                <div class="detail-item">
                    <label>Position</label>
                    <span>${mp.positionTitle}</span>
                </div>
                ` : ''}
                ${mp.managementLevel ? `
                <div class="detail-item">
                    <label>Management Level</label>
                    <span>${mp.managementLevel.toUpperCase()}</span>
                </div>
                ` : ''}
                ${mp.department ? `
                <div class="detail-item">
                    <label>Department</label>
                    <span>${mp.department}</span>
                </div>
                ` : ''}
                ${mp.industry ? `
                <div class="detail-item">
                    <label>Industry</label>
                    <span>${mp.industry.charAt(0).toUpperCase() + mp.industry.slice(1)}</span>
                </div>
                ` : ''}
            `;
        }

        // Load stats
        async function loadStats() {
            try {
                const token = localStorage.getItem('authToken');
                
                // Get jobs
                const jobsResponse = await fetch(`${API_URL}/api/jobs`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const jobs = jobsResponse.ok ? await jobsResponse.json() : [];
                
                // Get applications
                const appsResponse = await fetch(`${API_URL}/api/applications`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const applications = appsResponse.ok ? await appsResponse.json() : [];
                
                // Update stats
                document.getElementById('statJobs').textContent = jobs.filter(j => j.status === 'active').length;
                document.getElementById('statApplications').textContent = applications.length;
                document.getElementById('statInterviews').textContent = applications.filter(a => a.status === 'interview').length;
                document.getElementById('statHired').textContent = applications.filter(a => a.status === 'accepted').length;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load jobs
        async function loadJobs() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`${API_URL}/api/jobs`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const jobs = await response.json();
                    const jobsList = document.getElementById('jobsList');
                    
                    if (jobs.length === 0) {
                        jobsList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üíº</div>
                                <p>No jobs posted yet</p>
                                <button class="btn btn-primary" style="margin-top: 15px;" onclick="showToast('Job posting feature coming soon!', 'success')">
                                    Post a Job
                                </button>
                            </div>
                        `;
                    } else {
                        jobsList.innerHTML = jobs.map(job => `
                            <div class="job-item">
                                <div>
                                    <h4>${job.title}</h4>
                                    <p>${job.location || 'No location'} ‚Ä¢ ${job.jobType || 'Full-time'}</p>
                                    <div class="job-meta">
                                        <span>üìÖ ${new Date(job.createdAt).toLocaleDateString()}</span>
                                        <span>üë§ ${job.applications?.length || 0} Applications</span>
                                    </div>
                                </div>
                                <span class="job-status ${job.status}">${job.status}</span>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }

        // Load applications
        async function loadApplications() {
            try {
                const token = localStorage.getItem('authToken');
                const response = await fetch(`${API_URL}/api/applications`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const applications = await response.json();
                    const appsList = document.getElementById('applicationsList');
                    
                    if (applications.length === 0) {
                        appsList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <p>No applications received yet</p>
                            </div>
                        `;
                    } else {
                        appsList.innerHTML = applications.map(app => `
                            <div class="application-item">
                                <h4>${app.employeeName || 'Unknown Applicant'}</h4>
                                <p>${app.employeeEmail || 'No email'}</p>
                                <div class="application-meta">
                                    <span>üìÖ Applied: ${new Date(app.appliedAt).toLocaleDateString()}</span>
                                    <span class="application-status ${app.status}">${app.status}</span>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading applications:', error);
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // Initialize page
        async function init() {
            const user = await checkAuth();
            if (user) {
                displayUserProfile(user);
            }
        }

        // Start initialization
        init();
    </script>
</body>
</html>
